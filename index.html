<!DOCTYPE html><html><head><title>The Ponies</title>
<style type="text/css">
	html, body {
		background:
		url(images/src/transparent_background.png);
		width: 100%; height: 100%;
		margin: 0; padding: 0;
		overflow: hidden;
	}
</style>
<script type="text/javascript">
/**
 * Ensure scritps are loaded in order!
 *
 * @param String url Optional, if specified the queue script for laoding.
 *
 * @return void
 */
window.include = function(url) {
	self = this.include

	if (undefined === self.included) {
		self.included = []
	}

	if (url !== undefined) {
		script = document.createElement('script')
		script.src = url
		script.onload = function() {window.include()}

		if (undefined === self.includes) {
			self.includes = Array()
			document.head.appendChild(script)
			self.included.push(script)
		} else {
			self.includes.push(script)
		}
	} else {
		if (0 === self.includes.length) {
			self.includes = undefined
		} else {
			script = self.includes.shift()
			document.head.appendChild(script)
			self.included.push(script)
		}
	}
}

window.onload = function() {this.main()};

include('js/json.js')
include('js/log.js')
include('js/uuid.js')
include('js/three-js/three.min.js')

// include('js/svg.js')
// include('js/equestria.js')

include('js/three-js/OrbitControls.js')
include('js/three-js/BasicShader.js')
include('js/three-js/stats.min.js')
// include('js/three-js/CSS3DRenderer.js')

include('js/the-ponies/settings.js')
include('js/the-ponies/tile-engine.js')

var camera, renderer

window.main = function () {

	// Stats
	stats = new Stats();
	stats.domElement.style.position = 'absolute';
	stats.domElement.style.top = '0px';
	document.body.appendChild( stats.domElement );

	// Viewing Window

	var scene  = new THREE.Scene();
	camera = new THREE.PerspectiveCamera(
		settings.fov, window.innerWidth / window.innerHeight,
		settings.clipNear, 10000
	);

	controls = new THREE.OrbitControls( camera );
	controls.addEventListener( 'change', render );

	renderer = new THREE.WebGLRenderer({ alpha: true });
	renderer.setSize(
		settings.renderResolutionWidth,
		settings.renderResolutionHeight
	);
	document.body.appendChild( renderer.domElement );

	// Game Geometry

	// Grid

	var size = settings.chunk.camera.x * 16, step = 16;

	var geometry = new THREE.Geometry();

	for ( var i = - size; i <= size; i += step ) {

		geometry.vertices.push( new THREE.Vector3( - size, 0.5, i ) );
		geometry.vertices.push( new THREE.Vector3(   size, 0.5, i ) );

		geometry.vertices.push( new THREE.Vector3( i, 0.5, - size ) );
		geometry.vertices.push( new THREE.Vector3( i, 0.5,   size ) );

	}

	var material = new THREE.LineBasicMaterial( { color: 0xffffff, opacity: 0.2 } );

	var line = new THREE.Line( geometry, material );
	line.type = THREE.LinePieces;
	scene.add( line );

	// Camera

	camera.position.y = 5;
	camera.position.x = 10;
	camera.position.z = 10;
	// camera.rotation.y += 0.01;

	// SKYBOX
	// var axes = new THREE.AxisHelper((settings.clipFar - 10) / 1.414);
	var axes = new THREE.AxisHelper(5000);
	axes.rotation.y = Math.PI/4;
	scene.add( axes );

	var imagePrefix = "images/src/skybox-test/";
	var directions  = ["RIGHT", "LEFT", "TOP", "BOTTOM", "FRONT", "BACK"];
	var imageSuffix = ".png";
	var skyGeometry = new THREE.CubeGeometry( 5000, 5000, 5000 );

	var materialArray = [];
	for (var i = 0; i < 6; i++)
		materialArray.push( new THREE.MeshBasicMaterial({
			map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
			side: THREE.BackSide
		}));
	var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
	var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
	skyBox.rotation.y = Math.PI/4;
	scene.add( skyBox );



	// Render Loop
	function animate() {

		requestAnimationFrame( animate );

		render();
		stats.update();

	}

	function render() {

		var timer = Date.now() * 0.0001;

		camera.lookAt( scene.position );

		renderer.render( scene, camera );

	}
	animate()

}
</script></head><body></body></html>
